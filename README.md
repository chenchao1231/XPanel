# XPanel - TCP数据中继平台系统

## 📋 项目概述

XPanel是一个基于插件架构的TCP数据中继平台系统，主要用于实现数据源与数据消费客户端之间的双向数据转发。系统采用模块化设计，支持插件动态加载，提供可视化的管理界面。

### 🎯 核心功能

- **TCP数据中继**: 实现数据源到消费客户端的透明数据转发
- **插件化架构**: 支持动态加载和管理插件
- **可视化管理**: 提供友好的图形界面进行系统管理
- **连接监控**: 实时监控连接状态和数据传输统计
- **断线重连**: 自动检测连接断开并重连
- **审计日志**: 完整记录数据传输和系统事件

### 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                    XPanel 主应用程序                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   插件管理器     │  │   主题系统      │  │   标签管理器     │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │   插件接口层       │
                    │ XPluginInterface  │
                    └─────────┬─────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
┌───────▼────────┐   ┌────────▼────────┐   ┌───────▼────────┐
│ XPluginSample  │   │XPluginTcpServer │   │XPluginTcpRelay │
│   示例插件      │   │ TCP服务器插件   │   │ TCP中继插件    │
└────────────────┘   └─────────────────┘   └────────────────┘
```

## 📁 项目结构

```
XPanel/
├── MainAPP/                    # 主应用程序
│   ├── Forms/                  # 窗体文件
│   │   └── MainForm.cs         # 主窗体
│   ├── Panels/                 # 面板组件
│   │   ├── PluginManagerPanel.cs  # 插件管理面板
│   │   ├── SettingsPanel.cs    # 系统设置面板
│   │   └── AboutPanel.cs       # 关于面板
│   ├── Plugins/                # 插件管理
│   │   ├── XPluginManager.cs   # 插件管理器
│   │   └── PluginLoader.cs     # 插件加载器
│   ├── Registry/               # 注册表管理
│   │   └── PanelRegistry.cs    # 面板注册表
│   ├── Tabs/                   # 标签管理
│   ├── Layout/                 # 布局管理
│   └── Program.cs              # 程序入口
├── XPluginInterface/           # 插件接口定义
│   ├── IXPanelInterface.cs     # 面板插件接口
│   ├── IServerPlugin.cs        # 服务插件接口
│   ├── Configuration/          # 配置相关
│   ├── Network/                # 网络相关
│   ├── Services/               # 服务相关
│   ├── Theme/                  # 主题相关
│   ├── Utils/                  # 工具类
│   └── Auditing/               # 审计相关
├── XPluginSample/              # 示例插件
│   ├── Models/                 # 数据模型
│   ├── Services/               # 业务服务
│   ├── UI/                     # 用户界面
│   ├── Utils/                  # 工具类
│   ├── SamplePlugin.cs         # 插件主类
│   └── 插件文档/               # 插件文档
├── XPluginTcpServer/           # TCP服务器插件
│   ├── Models/                 # 数据模型
│   ├── Services/               # 业务服务
│   ├── UI/                     # 用户界面
│   ├── Utils/                  # 工具类
│   ├── TcpServerPlugin.cs      # 插件主类
│   └── 插件文档/               # 插件文档
├── XPluginTcpRelay/            # TCP中继插件（核心功能）
│   ├── Models/                 # 数据模型
│   │   ├── RouteRule.cs        # 路由规则模型
│   │   ├── ConnectionInfo.cs   # 连接信息模型
│   │   └── RelayConfig.cs      # 中继配置模型
│   ├── Services/               # 业务服务
│   │   ├── TcpRelayManager.cs  # TCP中继管理器
│   │   ├── ConfigManager.cs    # 配置管理服务
│   │   └── DataAuditor.cs      # 数据审计服务
│   ├── UI/                     # 用户界面
│   │   ├── RelayControlPanel.cs    # 主控制面板
│   │   └── RouteRuleDialog.cs      # 路由规则配置对话框
│   ├── Scripts/                # 部署脚本
│   ├── TcpRelayPlugin.cs       # 插件主类
│   └── 插件文档/               # 插件文档
├── XPanel.sln                  # 解决方案文件
├── global.json                 # .NET全局配置
├── Directory.Build.props       # MSBuild属性文件
└── README.md                   # 项目说明文档
```

## 🚀 快速开始

### 环境要求

- .NET 8.0 或更高版本
- Windows 操作系统
- Visual Studio 2022 或 JetBrains Rider

### 编译和运行

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd XPanel
   ```

2. **编译解决方案**
   ```bash
   dotnet build XPanel.sln
   ```

3. **运行主程序**
   ```bash
   cd MainAPP
   dotnet run
   ```

### 插件开发

1. **创建插件项目**
   - 参考 `XPluginSample` 项目结构
   - 引用 `XPluginInterface` 项目

2. **实现插件接口**
   ```csharp
   public class MyPlugin : IXPanelInterface
   {
       public string Name => "我的插件";
       
       public UserControl CreatePanel()
       {
           return new MyPluginPanel();
       }
   }
   ```

3. **编译和部署**
   - 编译插件项目
   - 将生成的DLL复制到主程序的 `XPlugins` 目录

## 🔧 系统配置

### 中继规则配置

系统支持多个TCP中继规则同时运行，每个规则包含：

- **规则名称**: 便于识别的名称
- **数据源地址**: 数据源的IP地址和端口
- **本地监听端口**: 数据消费客户端连接的端口
- **包大小**: 数据包缓冲区大小
- **启用状态**: 规则是否启用

### 系统运行流程

1. **启动后** → 加载规则列表
2. **一键启动** → 批量启动启用的规则 → 启动监听器 → 连接数据源 → 监听并重连
3. **一键关闭** → 断开数据源连接 → 关闭所有监听
4. **右键操作** → 单个规则的启动/关闭 → 刷新状态

## 📊 功能特性

### 中继平台职能

- **数据转发**: 数据源消息 → 中继平台转发 → 数据客户端
- **双向通信**: 数据客户端 → 中继平台转发 → 数据源
- **连接管理**: 监听数据源连接状态，保持稳定连接
- **日志记录**: 记录数据收发日志
- **统计分析**: 统计收发报文数据大小

### 技术特性

- **异步IO**: .NET 8异步Socket + Task-based异步模式
- **并发控制**: ConcurrentDictionary + 线程安全操作
- **事件驱动**: 基于事件的状态更新机制
- **资源管理**: 完整的Dispose模式实现
- **插件化**: 支持动态加载和卸载插件

## 📝 开发规范

### 代码规范

- 遵循C#编码规范和命名约定
- 使用异步编程模式（async/await）
- 实现完整的异常处理和资源管理
- 添加详细的XML文档注释

### 插件规范

- 插件文件名以"XPlugin"开头
- 实现IXPanelInterface接口
- 支持动态加载和卸载
- 提供友好的错误处理

### 命名规范

- 日志、代码任何地方请使用专业术语，避免使用非专业名词
- 涉及到作者、开发团队等相关角色请使用 "小白很菜"

## 🔍 故障排除

### 常见问题

1. **插件加载失败**
   - 检查插件是否实现了正确的接口
   - 确认插件依赖项是否完整
   - 查看调试控制台的错误信息

2. **连接失败**
   - 检查网络连接和防火墙设置
   - 确认IP地址和端口配置正确
   - 查看审计日志了解详细错误信息

3. **性能问题**
   - 调整缓冲区大小
   - 检查并发连接数设置
   - 监控系统资源使用情况

## 📄 许可证

本项目采用 MIT 许可证。详情请参阅 LICENSE 文件。

## 👥 贡献

欢迎提交问题报告和功能请求。如需贡献代码，请：

1. Fork 本项目
2. 创建功能分支
3. 提交更改
4. 创建 Pull Request

## 📞 技术支持

如需技术支持或报告问题，请联系开发团队。

---

**开发者**: 小白很菜  
**开发时间**: 2024-2025年  
**基于**: .NET 8.0 + WinForms + 插件化架构
