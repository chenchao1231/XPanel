# XPanel 开发规范

## 代码规范

### 1. 命名规范

#### 项目命名
- 主项目：`XPanel`
- 插件接口项目：`XPluginInterface`
- 插件项目：以 `XPlugin` 开头，如 `XPluginSample`、`XPluginTcpServer`

#### 命名空间规范
- 主程序：`XPanel.*`
- 插件接口：`XPlugin`
- 插件实现：`XPlugin*`（如 `XPluginSample`）

#### 文件命名
- 插件DLL文件必须以 `XPlugin` 开头
- 配置文件使用小写，如 `global.json`
- 文档文件使用中文描述性名称

### 2. 目录结构规范

#### 主程序目录结构
```
MainAPP/
├── Forms/          # 窗体文件
├── Layout/         # UI布局
├── Panels/         # 内置面板
├── Plugins/        # 插件管理
├── Registry/       # 注册管理
├── Tabs/           # 标签页管理
└── Utils/          # 工具类（可选）
```

#### 插件项目结构
```
XPlugin[Name]/
├── [Name]Plugin.cs     # 主插件类
├── [Name]Panel.cs      # 面板类（如果是面板插件）
├── [Name]Service.cs    # 服务类（如果是服务插件）
└── XPlugin[Name].csproj
```

### 3. 接口实现规范

#### 面板插件接口
```csharp
public class YourPlugin : IXPanelInterface
{
    public string Name => "插件显示名称";
    
    public UserControl CreatePanel()
    {
        return new YourPanel();
    }
}
```

#### 服务插件接口
```csharp
public class YourService : IServerPlugin
{
    public string Name => "服务名称";
    
    public void Start() { /* 启动逻辑 */ }
    public void Stop() { /* 停止逻辑 */ }
    public void Start(string ip, int port, ILogOutput output) { /* 带参数启动 */ }
    public void InitializePorts(IEnumerable<int> ports) { /* 端口初始化 */ }
}
```

## 插件开发规范

### 1. 插件项目配置

#### 项目文件配置
```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net8.0-windows</TargetFramework>
    <UseWindowsForms>true</UseWindowsForms>
    <Nullable>enable</Nullable>
    <AssemblyName>XPlugin[YourPluginName]</AssemblyName>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\XPluginInterface\XPluginInterface.csproj" />
  </ItemGroup>
</Project>
```

### 2. 插件生命周期

1. **加载阶段**: 插件DLL被扫描和加载
2. **注册阶段**: 插件接口被识别和注册
3. **激活阶段**: 用户通过菜单激活插件
4. **运行阶段**: 插件面板或服务正常运行
5. **卸载阶段**: 插件被禁用或卸载

### 3. 错误处理规范

#### 插件异常处理
```csharp
public UserControl CreatePanel()
{
    try
    {
        return new YourPanel();
    }
    catch (Exception ex)
    {
        // 记录错误日志
        Log.Error($"创建面板失败: {ex.Message}");
        
        // 返回错误面板或默认面板
        return CreateErrorPanel(ex.Message);
    }
}
```

#### 日志记录规范
- 使用统一的日志接口
- 记录关键操作和错误信息
- 日志级别：Debug、Info、Warning、Error

## UI设计规范

### 1. 面板设计规范

#### 基本要求
- 继承自 `UserControl`
- 支持 `Dock = DockStyle.Fill`
- 响应式布局设计
- 统一的颜色主题

#### 控件布局
```csharp
private void InitializeComponent()
{
    SuspendLayout();
    
    // 设置面板基本属性
    Size = new Size(600, 400);
    BackColor = Color.LightCyan;
    
    // 添加控件...
    
    ResumeLayout(false);
}
```

### 2. 主题和样式

#### 颜色规范
- 主背景色：`Color.LightYellow`
- 面板背景色：`Color.LightCyan`
- 按钮颜色：`Color.LightBlue`
- 文本颜色：`Color.DarkBlue`、`Color.DarkGreen`

#### 字体规范
- 标题字体：`Microsoft YaHei, 14F, FontStyle.Bold`
- 正文字体：`Microsoft YaHei, 10F`
- 系统字体：`SystemFonts.DefaultFont`

## 版本控制规范

### 1. 分支管理
- `main`: 主分支，稳定版本
- `develop`: 开发分支
- `feature/*`: 功能分支
- `hotfix/*`: 热修复分支

### 2. 提交规范
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构
- `test`: 测试相关

### 3. 版本号规范
采用语义化版本号：`主版本.次版本.修订版本`
- 主版本：不兼容的API修改
- 次版本：向下兼容的功能性新增
- 修订版本：向下兼容的问题修正

## 测试规范

### 1. 单元测试
- 为核心功能编写单元测试
- 测试覆盖率不低于80%
- 使用 xUnit 测试框架

### 2. 集成测试
- 测试插件加载和卸载
- 测试插件间的交互
- 测试UI功能

### 3. 性能测试
- 插件加载性能
- 内存使用情况
- UI响应性能

## 文档规范

### 1. 代码注释
- 公共接口必须有XML文档注释
- 复杂逻辑需要行内注释
- 使用中英文混合注释

### 2. 文档结构
- README.md：项目概述
- 使用说明.md：用户使用指南
- 开发规范.md：开发者规范
- API文档：接口说明

### 3. 更新维护
- 代码变更时同步更新文档
- 定期检查文档的准确性
- 保持文档的简洁和易读性
